# 6D旋转转换测试结果

## 测试日期
2025-10-17

## 测试目的
验证RDT-LIBERO训练和评估中的6D旋转转换是否正确，排除旋转转换导致方向错误的可能性。

## 测试结果

### ✅ 测试1：基本角度范围测试
测试了LIBERO实际使用的角度范围 [-0.5, 0.5] 弧度（对应归一化[-1, 1]）：
- 0.1, 0.2, 0.3 rad → 误差: 0.000000
- 0.0, 0.0, 0.0 rad → 误差: 0.000000
- 0.5, 0.5, 0.5 rad → 误差: 0.000000
- -0.5, -0.5, -0.5 rad → 误差: 0.000000

**结论**: 在LIBERO的角度范围内，6D旋转转换完全正确。

### ✅ 测试2：实际LIBERO数据测试
使用真实的LIBERO demo数据进行测试：
- 文件: KITCHEN_SCENE10_close_the_top_drawer_of_the_cabinet_and_put_the_black_bowl_on_top_of_it_demo.hdf5
- 测试了demo_0的前5步旋转动作
- 最大往返误差: 0.000000（小于1e-6）

**结论**: 实际数据的6D旋转转换完全可逆，无精度损失。

### ⚠️ 测试3：大角度范围警告
对于超出 [-π, π] 的随机大角度，6D转换可能产生欧拉角的多解问题（万向节死锁）。
但这不影响LIBERO数据，因为LIBERO的旋转增量很小（最大±0.5 rad ≈ ±28.6°）。

## 重要结论

**6D旋转转换是完全正确的！**

这意味着：
1. ✅ `utils/rotation_utils.py` 中的转换函数实现正确
2. ✅ 训练代码中的 `convert_euler_to_6d_rotation()` 正确
3. ✅ 评估代码中的 `convert_6d_rotation_to_euler()` 正确
4. ✅ 旋转转换是可逆的，不会引入方向错误

**因此，模型输出方向错误的问题一定是由位置坐标系不匹配引起的，与旋转无关！**

## 下一步建议

既然旋转转换没问题，那么方向错误100%是位置坐标系的问题。建议：

### 方案A：系统性确定坐标转换（推荐）

创建一个debug评估脚本，详细打印：
1. Demo的位置动作: (demo_x, demo_y, demo_z)
2. 模型的RDT输出: (rdt_x, rdt_y, rdt_z) 
3. 转换后的LIBERO动作: (lib_x, lib_y, lib_z)
4. 实际执行效果: 向左/右/前/后/上/下

从这些数值直接确定需要翻转哪些轴。

### 方案B：基于checkpoint-26000快速测试

如果checkpoint-26000是用"翻转所有轴"训练的：
1. 评估时也"翻转所有轴"回来 → 如果还是错的，说明训练时的翻转就是错的
2. 评估时不翻转 → 如果对了，说明训练时不该翻转
3. 评估时只翻转某些轴 → 逐个测试找到正确组合

### 方案C：重新训练baseline

用当前恢复的默认代码（无坐标翻转）快速训练5000步，直接观察方向错误，然后确定需要的翻转。

## 当前代码状态

已恢复到默认版本（假设RDT和LIBERO坐标系相同）：
- `data/hdf5_libero_dataset.py`: 无坐标翻转（commit c073c0a）
- `eval_sim/eval_rdt_libero.py`: 无坐标翻转（commit fcb25b0）
- 6D旋转转换: ✅ 已验证正确

准备好进行下一步的坐标系调试！

