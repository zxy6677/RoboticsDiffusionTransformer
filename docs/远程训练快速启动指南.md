# è¿œç¨‹è®­ç»ƒå¿«é€Ÿå¯åŠ¨æŒ‡å— ğŸš€

## æ ¸å¿ƒé—®é¢˜è§£ç­” â“

### Q: æ˜¯å¦éœ€è¦é‡æ–°è®¡ç®—ç»Ÿè®¡ä¿¡æ¯ï¼Ÿ

**ç­”ï¼šä¸éœ€è¦ï¼** âœ…

éªŒè¯ç»“æœï¼š
```bash
# æœ¬åœ°æ•°æ®é›†æ ¡éªŒå’Œ
1a602b00ddcd0a7d0edfad722e1c9f0d  datasets/libero_single_task/KITCHEN_SCENE10...hdf5

# è¿œç¨‹æ•°æ®é›†æ ¡éªŒå’Œ  
1a602b00ddcd0a7d0edfad722e1c9f0d  data/datasets/libero_single_task/KITCHEN_SCENE10...hdf5
```

**MD5å®Œå…¨ä¸€è‡´** â†’ æ•°æ®é›†ç›¸åŒ â†’ **æ— éœ€é‡æ–°è®¡ç®—ç»Ÿè®¡ä¿¡æ¯**

---

### Q: ç¼ºå°‘ `model.safetensors` æ€ä¹ˆåŠï¼Ÿ

**ç­”ï¼šè¿™ä¸æ˜¯é—®é¢˜ï¼** âœ…

**è®­ç»ƒä»£ç è‡ªåŠ¨æ”¯æŒä¸¤ç§æ ¼å¼ï¼š**

1. **ä¼˜å…ˆåŠ è½½**: `model.safetensors` (SafeTensorsæ ¼å¼)
2. **å¤‡ç”¨åŠ è½½**: `pytorch_model.bin` (PyTorchåŸç”Ÿæ ¼å¼)

ä»£ç é€»è¾‘ (`models/hub_mixin.py:42-49`):
```python
if os.path.isdir(model_id):
    try:
        # å…ˆå°è¯•åŠ è½½ SafeTensors
        model_file = os.path.join(model_id, "model.safetensors")
        return cls._load_as_safetensor(model, model_file, ...)
    except FileNotFoundError:
        # å¦‚æœä¸å­˜åœ¨ï¼ŒåŠ è½½ PyTorchæ ¼å¼
        model_file = os.path.join(model_id, "pytorch_model.bin")
        return cls._load_as_pickle(model, model_file, ...)
```

**æ‚¨çš„ rdt-1b ä½¿ç”¨ `pytorch_model.bin` æ˜¯å®Œå…¨æ­£å¸¸çš„ï¼**

---

## è¿œç¨‹æœåŠ¡å™¨å½“å‰çŠ¶æ€ ğŸ“Š

### âœ… å·²å°±ç»ªé¡¹

| é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| ä»£ç æ›´æ–° | âœ… | å·²pullåˆ°æœ€æ–°ç‰ˆæœ¬ (922adfe) |
| æ•°æ®é›† | âœ… | 1.0GB, MD5ä¸æœ¬åœ°ä¸€è‡´ |
| ç»Ÿè®¡ä¿¡æ¯ | âœ… | libero_single_taskå·²å­˜åœ¨ï¼Œæ•°å€¼æ­£å¸¸ |
| GPU | âœ… | 8å¼  A800-80GB å…¨éƒ¨å¯ç”¨ |
| é…ç½®æ–‡ä»¶ | âœ… | æ‰€æœ‰é…ç½®æ–‡ä»¶å®Œæ•´ |
| è®­ç»ƒè„šæœ¬ | âœ… | train_single_task_2gpu.sh å·²é…ç½®8-GPU |
| ç£ç›˜ç©ºé—´ | âœ… | 45GBå¯ç”¨ |
| æ–‡æœ¬ç¼–ç å™¨ | âœ… | google/t5-v1_1-xxl |
| è§†è§‰ç¼–ç å™¨ | âœ… | google/siglip-so400m-patch14-384 |

### âš ï¸ éœ€è¦å¤„ç†é¡¹

| é¡¹ç›® | çŠ¶æ€ | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| Condaç¯å¢ƒ | âš ï¸ | `conda activate rdt` |
| Pythonä¾èµ– | âš ï¸ | æ¿€æ´»rdtç¯å¢ƒåè‡ªåŠ¨å¯ç”¨ |
| é¢„è®­ç»ƒæ¨¡å‹ | âš ï¸ | éœ€è¦ä¸Šä¼  `checkpoints/rdt-1b/` |

---

## ç«‹å³å¼€å§‹è®­ç»ƒçš„æ­¥éª¤ ğŸ¯

### æ–¹æ¡ˆ1: ä¸Šä¼ é¢„è®­ç»ƒæ¨¡å‹åè®­ç»ƒï¼ˆæ¨èï¼‰

```bash
# === åœ¨æœ¬åœ° ===
cd /home/ubuntu/RoboticsDiffusionTransformer

# 1. æ‰“åŒ…é¢„è®­ç»ƒæ¨¡å‹
tar -czf rdt-1b.tar.gz checkpoints/rdt-1b/

# 2. ä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨
scp -o "ProxyJump zhukefei@134.175.121.223" \
    rdt-1b.tar.gz \
    zhukefei@172.16.0.27:~/RoboticsDiffusionTransformer/

# === åœ¨è¿œç¨‹æœåŠ¡å™¨ ===
ssh -J zhukefei@134.175.121.223 zhukefei@172.16.0.27

cd ~/RoboticsDiffusionTransformer

# 3. è§£å‹
tar -xzf rdt-1b.tar.gz
rm rdt-1b.tar.gz

# 4. éªŒè¯
ls -lh checkpoints/rdt-1b/pytorch_model.bin
# åº”è¯¥æ˜¾ç¤º 2.3G

# 5. æ¿€æ´»ç¯å¢ƒ
conda activate rdt

# 6. å†æ¬¡è¿è¡Œæ£€æŸ¥ï¼ˆå¯é€‰ï¼‰
bash remote_training_check.sh

# 7. å¼€å§‹è®­ç»ƒ
tmux new -s training
bash train_single_task_2gpu.sh
```

### æ–¹æ¡ˆ2: ä»å¤´è®­ç»ƒï¼ˆä¸æ¨èï¼Œéœ€è¦å¾ˆé•¿æ—¶é—´ï¼‰

å¦‚æœä¸ä¸Šä¼ é¢„è®­ç»ƒæ¨¡å‹ï¼Œè®­ç»ƒè„šæœ¬ä¼šä»éšæœºåˆå§‹åŒ–å¼€å§‹è®­ç»ƒï¼Œéœ€è¦æ›´å¤šæ—¶é—´æ”¶æ•›ã€‚

---

## é¢„è®­ç»ƒæ¨¡å‹æ–‡ä»¶ç»“æ„ ğŸ“

æ­£ç¡®çš„ `checkpoints/rdt-1b/` ç»“æ„ï¼š

```
checkpoints/rdt-1b/
â”œâ”€â”€ config.json              â† æ¨¡å‹é…ç½® (å¿…éœ€)
â”œâ”€â”€ pytorch_model.bin        â† æ¨¡å‹æƒé‡ (å¿…éœ€ï¼Œ2.3GB)
â””â”€â”€ README.md                â† è¯´æ˜æ–‡æ¡£ (å¯é€‰)
```

**æ³¨æ„**ï¼š
- `pytorch_model.bin` å’Œ `model.safetensors` æ˜¯ä¸¤ç§ä¸åŒæ ¼å¼ï¼Œåªéœ€è¦å…¶ä¸­ä¸€ç§
- rdt-1b å®˜æ–¹ä½¿ç”¨çš„æ˜¯ `pytorch_model.bin`
- è®­ç»ƒä»£ç ä¼šè‡ªåŠ¨é€‰æ‹©å¯ç”¨çš„æ ¼å¼

---

## å®Œæ•´æ£€æŸ¥å‘½ä»¤ ğŸ”

åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œï¼š

```bash
cd ~/RoboticsDiffusionTransformer
conda activate rdt
bash remote_training_check.sh
```

æ£€æŸ¥è„šæœ¬ä¼šéªŒè¯ï¼š
- âœ“ Pythonç¯å¢ƒå’Œä¾èµ–
- âœ“ 8å¼ GPUçŠ¶æ€
- âœ“ æ•°æ®é›†æ–‡ä»¶ (éªŒè¯MD5)
- âœ“ ç»Ÿè®¡ä¿¡æ¯ (libero_single_task)
- âœ“ é…ç½®æ–‡ä»¶å®Œæ•´æ€§
- âœ“ é¢„è®­ç»ƒæ¨¡å‹ (ä¸¤ç§æ ¼å¼)
- âœ“ ç£ç›˜ç©ºé—´

---

## é¢„æœŸè®­ç»ƒé…ç½® âš™ï¸

```bash
# ç¡¬ä»¶é…ç½®
GPU: 8å¼  A800-80GB (80GBæ˜¾å­˜/GPU)
æ€»æ˜¾å­˜: 640GB

# è®­ç»ƒå‚æ•°
num_processes: 8
train_batch_size: 4 (æ¯GPU)
æ€»batch size: 32
gradient_accumulation: 1
æœ‰æ•ˆbatch size: 32

learning_rate: 1e-4
max_train_steps: 30000
checkpointing_period: 2000

# é¢„è®¡æ—¶é—´
æ€»è®­ç»ƒæ—¶é—´: ~3-4å°æ—¶ (8-GPU)
Checkpointä¿å­˜: æ¯2000æ­¥
é¢„è®¡Checkpointæ•°é‡: 15ä¸ª
```

---

## è®­ç»ƒç›‘æ§ ğŸ“ˆ

### ä½¿ç”¨tmuxï¼ˆæ¨èï¼‰

```bash
# åˆ›å»ºä¼šè¯
tmux new -s training

# è¿è¡Œè®­ç»ƒ
bash train_single_task_2gpu.sh

# åˆ†ç¦»ä¼šè¯: Ctrl+B, ç„¶åæŒ‰ D
# é‡æ–°è¿æ¥: tmux attach -t training

# æŸ¥çœ‹æ‰€æœ‰ä¼šè¯
tmux ls

# ç»“æŸä¼šè¯
tmux kill-session -t training
```

### GPUç›‘æ§

```bash
# å®æ—¶ç›‘æ§GPU
watch -n 1 nvidia-smi

# æˆ–ä½¿ç”¨gpustatï¼ˆå¦‚æœå®‰è£…ï¼‰
watch -n 1 gpustat
```

### æ—¥å¿—ç›‘æ§

```bash
# å¦‚æœä½¿ç”¨nohup
tail -f train.log

# æŸ¥çœ‹è®­ç»ƒæ­¥æ•°
grep "step" train.log | tail -20
```

### Checkpointæ£€æŸ¥

```bash
# æŸ¥çœ‹å·²ä¿å­˜çš„checkpoint
ls -lht checkpoints/single_task_scene10_2gpu/ | head

# æŸ¥çœ‹æœ€æ–°checkpoint
ls -lhtr checkpoints/single_task_scene10_2gpu/checkpoint-*/
```

---

## æ•…éšœæ’æŸ¥ ğŸ”§

### é—®é¢˜1: CUDA Out of Memory

```bash
# è§£å†³æ–¹æ¡ˆ1: å‡å°‘batch size
# ä¿®æ”¹ train_single_task_2gpu.sh
--train_batch_size=2  # ä»4æ”¹ä¸º2

# è§£å†³æ–¹æ¡ˆ2: å¯ç”¨gradient checkpointing
--gradient_checkpointing
```

### é—®é¢˜2: æ•°æ®åŠ è½½æ…¢

```bash
# æ£€æŸ¥dataloader workers
--dataloader_num_workers=8  # å½“å‰è®¾ç½®

# å¦‚æœCPUä¸è¶³ï¼Œå¯ä»¥å‡å°‘
--dataloader_num_workers=4
```

### é—®é¢˜3: æ‰¾ä¸åˆ°æ¨¡å—

```bash
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•
pwd  # åº”è¯¥æ˜¯ /home/zhukefei/RoboticsDiffusionTransformer

# ç¡®ä¿condaç¯å¢ƒæ¿€æ´»
conda activate rdt

# æ£€æŸ¥Pythonè·¯å¾„
python -c "import sys; print(sys.path)"
```

### é—®é¢˜4: ç¼–ç å™¨ä¸‹è½½æ…¢

```bash
# ä½¿ç”¨HuggingFaceé•œåƒ
export HF_ENDPOINT=https://hf-mirror.com

# æˆ–è€…ä»æœ¬åœ°ä¸Šä¼ ç¼–ç å™¨
# æœ¬åœ°æ‰“åŒ…
tar -czf encoders.tar.gz google/

# ä¸Šä¼ å¹¶è§£å‹
scp -o "ProxyJump ..." encoders.tar.gz ...
tar -xzf encoders.tar.gz
```

---

## å…³é”®ç¯å¢ƒå˜é‡ ğŸ”‘

```bash
# æ•°æ®é›†è·¯å¾„ï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®ï¼‰
export LIBERO_DATASET_DIR="./data/datasets/libero_single_task"

# GPUé€‰æ‹©
export CUDA_VISIBLE_DEVICES=0,1,2,3,4,5,6,7

# HuggingFaceï¼ˆå¯é€‰ï¼‰
export HF_ENDPOINT=https://hf-mirror.com  # ä½¿ç”¨é•œåƒ
export HF_HOME=/path/to/cache             # ç¼“å­˜ç›®å½•

# Weights & Biasesï¼ˆå¯é€‰ï¼‰
export WANDB_MODE=offline                 # ç¦»çº¿æ¨¡å¼
export WANDB_DISABLED=true                # ç¦ç”¨W&B
```

---

## è®­ç»ƒå®Œæˆå ğŸ‰

### 1. æŸ¥çœ‹checkpoint

```bash
ls -lh checkpoints/single_task_scene10_2gpu/checkpoint-*/
```

### 2. é€‰æ‹©æœ€ä½³checkpoint

é€šå¸¸æœ€åä¸€ä¸ªcheckpoint (step 30000) æ•ˆæœæœ€å¥½ï¼Œä½†ä¹Ÿå¯ä»¥æ ¹æ®éªŒè¯lossé€‰æ‹©ã€‚

### 3. è¿è¡Œè¯„ä¼°

```bash
export CUDA_VISIBLE_DEVICES=0

python eval_sim/eval_rdt_libero.py \
    --config configs/base.yaml \
    --pretrained checkpoints/single_task_scene10_2gpu/checkpoint-30000/ema/model.safetensors \
    --text_encoder google/t5-v1_1-xxl \
    --vision_encoder google/siglip-so400m-patch14-384 \
    --benchmark libero_90 \
    --num_tasks 2 \
    --max_steps 200 \
    --exec_horizon 16 \
    --record_video \
    --video_output_dir videos/remote_8gpu_eval
```

### 4. ä¸‹è½½ç»“æœ

```bash
# åœ¨æœ¬åœ°è¿è¡Œ
scp -o "ProxyJump zhukefei@134.175.121.223" \
    -r zhukefei@172.16.0.27:~/RoboticsDiffusionTransformer/videos/remote_8gpu_eval \
    ./videos/

scp -o "ProxyJump zhukefei@134.175.121.223" \
    -r zhukefei@172.16.0.27:~/RoboticsDiffusionTransformer/checkpoints/single_task_scene10_2gpu/checkpoint-30000 \
    ./checkpoints/remote_8gpu_checkpoint/
```

---

## æ€»ç»“ ğŸ“

### ç«‹å³å¯ä»¥å¼€å§‹è®­ç»ƒï¼

**å‰ææ¡ä»¶**ï¼š
1. âœ… æ•°æ®é›†å·²å°±ç»ªï¼ˆMD5éªŒè¯é€šè¿‡ï¼‰
2. âœ… ç»Ÿè®¡ä¿¡æ¯æ­£ç¡®ï¼ˆæ— éœ€é‡æ–°è®¡ç®—ï¼‰
3. âš ï¸ éœ€è¦ä¸Šä¼ é¢„è®­ç»ƒæ¨¡å‹ `checkpoints/rdt-1b/pytorch_model.bin`

**æœ€å¿«å¯åŠ¨è·¯å¾„**ï¼š
```bash
# 1. ä¸Šä¼ é¢„è®­ç»ƒæ¨¡å‹ï¼ˆæœ¬åœ°â†’è¿œç¨‹ï¼‰
scp -o "ProxyJump ..." rdt-1b.tar.gz ...

# 2. è¿œç¨‹è§£å‹
tar -xzf rdt-1b.tar.gz

# 3. æ¿€æ´»ç¯å¢ƒå¹¶è®­ç»ƒ
conda activate rdt
tmux new -s training
bash train_single_task_2gpu.sh
```

**é¢„è®¡æ—¶é—´**ï¼š
- ä¸Šä¼ æ¨¡å‹ï¼š~5-10åˆ†é’Ÿï¼ˆ2.3GBï¼‰
- è®­ç»ƒæ—¶é—´ï¼š~3-4å°æ—¶ï¼ˆ8-GPU, 30000æ­¥ï¼‰
- æ€»è®¡ï¼š~4å°æ—¶

---

**çŠ¶æ€**ï¼šâœ… æ‰€æœ‰å‡†å¤‡å·¥ä½œå®Œæˆï¼Œåªéœ€ä¸Šä¼ é¢„è®­ç»ƒæ¨¡å‹å³å¯å¼€å§‹ï¼

**æœ€åæ›´æ–°**ï¼š2024-10-19

